<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>SpectraSimulations_git.aps.SpecSimu API documentation</title>
<meta name="description" content="Module that implements the spectra simulations.
First we search and read all the required files to simulate the selected element, as well as all â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>SpectraSimulations_git.aps.SpecSimu</code></h1>
</header>
<section id="section-intro">
<p>Module that implements the spectra simulations.
First we search and read all the required files to simulate the selected element, as well as all charge states if they exist.
Second we initialize the Tkinter interface. In this initialization all the functions that calculate and plot the simulated spectrum are bound to interface variables and buttons.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Module that implements the spectra simulations.
First we search and read all the required files to simulate the selected element, as well as all charge states if they exist.
Second we initialize the Tkinter interface. In this initialization all the functions that calculate and plot the simulated spectrum are bound to interface variables and buttons.
&#34;&#34;&#34;

#GUI message box for CS missmatch warning
from tkinter import messagebox

#OS Imports for files paths
import os

#Data Imports for variable management
import data.variables as generalVars

#File IO Imports
from utils.fileIO import readRates, readShakeWeights
from utils.fileIO import searchChargeStates, readChargeStates, readIonPop

#Function Imports
import utils.functions

#GUI utils for interface setup
from utils.interface import on_key_event, enter_function
from utils.interface import configureSimuPlot, configureButtonArea, setupButtonArea, setupMenus
import utils.interface as guiVars


def simulateSpectra(dir_path, element, parent):
    &#34;&#34;&#34;
    Function to run the simulations interface
        
        Args:
            dir_path: full path to the location where the application is ran
            element: list with the [z value, element name] to simulate
            parent: parent tkinter window object where we will bind the new interface
        
        Returns:
            Nothing, we just setup the interface and all commands are bound and performed through the interface
    &#34;&#34;&#34;
    # ----------------------------------------------------------------------------------------------#
    #                                                                                               #
    #                   INITIALIZE AND READ DATA FROM THE PREDEFINED FILES                          #
    #                                                                                               #
    #-----------------------------------------------------------------------------------------------#
    
    # Retrieve the z and name of the element to simulate
    z = element[0]
    &#34;&#34;&#34;
    Variable with the z value of the element to simulate
    &#34;&#34;&#34;
    element_name = element[1]
    &#34;&#34;&#34;
    Variable with the element name to simulate
    &#34;&#34;&#34;
    
    # Initialize the element name for the functions module
    utils.functions.element_name = element_name
    
    # Path to the radiative rates file for this element
    radrates_file = dir_path / str(z) / (str(z) + &#39;-intensity.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the radiative rates file of this element
    &#34;&#34;&#34;
    # Read the rates file
    generalVars.lineradrates = readRates(radrates_file)

    # Path to the satellite rates file for this element
    satellites_file = dir_path / str(z) / (str(z) + &#39;-satinty.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the satellite rates file of this element
    &#34;&#34;&#34;
    # Read the rates file
    generalVars.linesatellites = readRates(satellites_file)

    # Path to the auger rates file for this element
    augrates_file = dir_path / str(z) / (str(z) + &#39;-augrate.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the auger rates file of this element
    &#34;&#34;&#34;
    # Read the rates file
    generalVars.lineauger = readRates(augrates_file)

    # Path to the shake weigths file for this element
    shakeweights_file = dir_path / str(z) / (str(z) + &#39;-shakeweights.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the shake weights file of this element
    &#34;&#34;&#34;
    # Read the shake weights file
    generalVars.shakeweights, generalVars.label1 = readShakeWeights(shakeweights_file)

    # Variable to active or deactivate the charge state simulation in the interface menu
    CS_exists = False
    &#34;&#34;&#34;
    Variable to control if this element has transition rates for different charge states
    &#34;&#34;&#34;
    
    # Check if the charge states folder exists in the element folder
    if os.path.isdir(dir_path / str(z) / &#39;Charge_States&#39;):
        CS_exists = True
        
        # Search for the existing radiative files inside the charge states folder
        generalVars.radiative_files = searchChargeStates(dir_path, z, &#39;-intensity_&#39;)
        # Load the raw data from the found files and the order in which they were loaded
        generalVars.lineradrates_PCS, generalVars.lineradrates_NCS, generalVars.rad_PCS, generalVars.rad_NCS = readChargeStates(generalVars.radiative_files, dir_path, z)

        # Search for the existing auger files inside the charge states folder
        generalVars.auger_files = searchChargeStates(dir_path, z, &#39;-augrate_&#39;)
        # Load the raw data from the found files and the order in which they were loaded
        generalVars.lineaugrates_PCS, generalVars.lineaugrates_NCS, generalVars.aug_PCS, generalVars.aug_NCS = readChargeStates(generalVars.auger_files, dir_path, z)

        # Search for the existing satellite files inside the charge states folder
        generalVars.sat_files = searchChargeStates(dir_path, z, &#39;-satinty_&#39;)
        # Load the raw data from the found files and the order in which they were loaded
        generalVars.linesatellites_PCS, generalVars.linesatellites_NCS, generalVars.sat_PCS, generalVars.sat_NCS = readChargeStates(generalVars.sat_files, dir_path, z)


        # Check for a missmatch in the read radiative and satellite files.
        # There should be 1 satellite for each radiative file if you want to simulate a full rad + sat spectrum
        # Otherwise, if you know what you are doing just ignore the warning
        if len(generalVars.linesatellites_NCS) != len(generalVars.lineradrates_NCS) or len(generalVars.linesatellites_PCS) != len(generalVars.lineradrates_PCS):
            messagebox.showwarning(&#34;Warning&#34;, &#34;Missmatch of radiative and satellite files for Charge State mixture: &#34; + str(len(generalVars.lineradrates_NCS) + len(generalVars.lineradrates_PCS)) + &#34; radiative and &#34; + str(len(generalVars.linesatellites_NCS) + len(generalVars.linesatellites_PCS)) + &#34; satellite files found.&#34;)

        # Path to the ion population file file for this element
        ionpop_file = dir_path / str(z) / (str(z) + &#39;-ionpop.out&#39;)
        &#34;&#34;&#34;
        Variable with the full path to the ion population file of this element
        &#34;&#34;&#34;
        # Check if the ion population data exists and load it
        generalVars.Ionpop_exists, generalVars.ionpopdata = readIonPop(ionpop_file)

    
    # ----------------------------------------------------------------------------------------------#
    #                                                                                               #
    #                                  INITIALIZE GUI ELEMENTS                                      #
    #                                                                                               #
    #-----------------------------------------------------------------------------------------------#
    
    # Setup the variables to use in the GUI entries
    guiVars.setupVars(parent)
    
    # Initialize the main simulation window, with the main plot inside
    sim, panel_1, f, a, figure_frame, canvas = configureSimuPlot()
    &#34;&#34;&#34;
    sim: variable to hold the tkinter simulation window object.
    panel_1: panel object that holds the matplotlib graph in the interface.
    f: matplotlib figure object where the graph will be displayed.
    a: matplotlib plot object where we can plot the data.
    figure_frame: frame that is placed inside the panel_1 object where the figure will be placed.
    canvas: tkinter object created from the matplotlib figure which is required to place the figure in the interface.
    &#34;&#34;&#34;
    # Initialize the remaining panels containing the buttons and configuration entries for the simulation
    panel_2, toolbar_frame, toolbar, full_frame, buttons_frame, buttons_frame2, buttons_frame3, buttons_frame4 = configureButtonArea(sim, canvas)
    &#34;&#34;&#34;
    panel_2: panel object that holds the controls placed below the graph
    toolbar_frame: frame that holds the toolbar buttons for the matplotlib plot
    toolbar: default toolbar buttons for the matplotlib plot
    full_frame: full frame for the button area to configure the simulations
    buttons_frame: frame for the transition dropdown
    buttons_frame2: frame for the simulation bounds and number of points
    buttons_frame3: frame for the yoffset, energy offset and calculate
    buttons_frame4: frame for the progress bar
    &#34;&#34;&#34;
    # Finish the button area setup and bind the variables to the GUI elements
    setupButtonArea(buttons_frame, buttons_frame2, buttons_frame3, buttons_frame4)
    
    # Bind the default matplotlib shortcuts
    canvas.mpl_connect(&#39;key_press_event&#39;, on_key_event)

    # Bind para correr a calculate quando se clica no enter
    sim.bind(&#39;&lt;Return&gt;&#39;, enter_function)
    
    # Setup the dropdown menus on the toolbar on the top of the window
    setupMenus(CS_exists)
    
    # ---------------------------------------------------------------------------------------------------------------
    # Initialize the main loop of the tk window (Enables the user interaction with the GUI)
    sim.mainloop()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="SpectraSimulations_git.aps.SpecSimu.simulateSpectra"><code class="name flex">
<span>def <span class="ident">simulateSpectra</span></span>(<span>dir_path, element, parent)</span>
</code></dt>
<dd>
<div class="desc"><p>Function to run the simulations interface</p>
<pre><code>Args:
    dir_path: full path to the location where the application is ran
    element: list with the [z value, element name] to simulate
    parent: parent tkinter window object where we will bind the new interface

Returns:
    Nothing, we just setup the interface and all commands are bound and performed through the interface
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def simulateSpectra(dir_path, element, parent):
    &#34;&#34;&#34;
    Function to run the simulations interface
        
        Args:
            dir_path: full path to the location where the application is ran
            element: list with the [z value, element name] to simulate
            parent: parent tkinter window object where we will bind the new interface
        
        Returns:
            Nothing, we just setup the interface and all commands are bound and performed through the interface
    &#34;&#34;&#34;
    # ----------------------------------------------------------------------------------------------#
    #                                                                                               #
    #                   INITIALIZE AND READ DATA FROM THE PREDEFINED FILES                          #
    #                                                                                               #
    #-----------------------------------------------------------------------------------------------#
    
    # Retrieve the z and name of the element to simulate
    z = element[0]
    &#34;&#34;&#34;
    Variable with the z value of the element to simulate
    &#34;&#34;&#34;
    element_name = element[1]
    &#34;&#34;&#34;
    Variable with the element name to simulate
    &#34;&#34;&#34;
    
    # Initialize the element name for the functions module
    utils.functions.element_name = element_name
    
    # Path to the radiative rates file for this element
    radrates_file = dir_path / str(z) / (str(z) + &#39;-intensity.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the radiative rates file of this element
    &#34;&#34;&#34;
    # Read the rates file
    generalVars.lineradrates = readRates(radrates_file)

    # Path to the satellite rates file for this element
    satellites_file = dir_path / str(z) / (str(z) + &#39;-satinty.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the satellite rates file of this element
    &#34;&#34;&#34;
    # Read the rates file
    generalVars.linesatellites = readRates(satellites_file)

    # Path to the auger rates file for this element
    augrates_file = dir_path / str(z) / (str(z) + &#39;-augrate.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the auger rates file of this element
    &#34;&#34;&#34;
    # Read the rates file
    generalVars.lineauger = readRates(augrates_file)

    # Path to the shake weigths file for this element
    shakeweights_file = dir_path / str(z) / (str(z) + &#39;-shakeweights.out&#39;)
    &#34;&#34;&#34;
    Variable with the full path to the shake weights file of this element
    &#34;&#34;&#34;
    # Read the shake weights file
    generalVars.shakeweights, generalVars.label1 = readShakeWeights(shakeweights_file)

    # Variable to active or deactivate the charge state simulation in the interface menu
    CS_exists = False
    &#34;&#34;&#34;
    Variable to control if this element has transition rates for different charge states
    &#34;&#34;&#34;
    
    # Check if the charge states folder exists in the element folder
    if os.path.isdir(dir_path / str(z) / &#39;Charge_States&#39;):
        CS_exists = True
        
        # Search for the existing radiative files inside the charge states folder
        generalVars.radiative_files = searchChargeStates(dir_path, z, &#39;-intensity_&#39;)
        # Load the raw data from the found files and the order in which they were loaded
        generalVars.lineradrates_PCS, generalVars.lineradrates_NCS, generalVars.rad_PCS, generalVars.rad_NCS = readChargeStates(generalVars.radiative_files, dir_path, z)

        # Search for the existing auger files inside the charge states folder
        generalVars.auger_files = searchChargeStates(dir_path, z, &#39;-augrate_&#39;)
        # Load the raw data from the found files and the order in which they were loaded
        generalVars.lineaugrates_PCS, generalVars.lineaugrates_NCS, generalVars.aug_PCS, generalVars.aug_NCS = readChargeStates(generalVars.auger_files, dir_path, z)

        # Search for the existing satellite files inside the charge states folder
        generalVars.sat_files = searchChargeStates(dir_path, z, &#39;-satinty_&#39;)
        # Load the raw data from the found files and the order in which they were loaded
        generalVars.linesatellites_PCS, generalVars.linesatellites_NCS, generalVars.sat_PCS, generalVars.sat_NCS = readChargeStates(generalVars.sat_files, dir_path, z)


        # Check for a missmatch in the read radiative and satellite files.
        # There should be 1 satellite for each radiative file if you want to simulate a full rad + sat spectrum
        # Otherwise, if you know what you are doing just ignore the warning
        if len(generalVars.linesatellites_NCS) != len(generalVars.lineradrates_NCS) or len(generalVars.linesatellites_PCS) != len(generalVars.lineradrates_PCS):
            messagebox.showwarning(&#34;Warning&#34;, &#34;Missmatch of radiative and satellite files for Charge State mixture: &#34; + str(len(generalVars.lineradrates_NCS) + len(generalVars.lineradrates_PCS)) + &#34; radiative and &#34; + str(len(generalVars.linesatellites_NCS) + len(generalVars.linesatellites_PCS)) + &#34; satellite files found.&#34;)

        # Path to the ion population file file for this element
        ionpop_file = dir_path / str(z) / (str(z) + &#39;-ionpop.out&#39;)
        &#34;&#34;&#34;
        Variable with the full path to the ion population file of this element
        &#34;&#34;&#34;
        # Check if the ion population data exists and load it
        generalVars.Ionpop_exists, generalVars.ionpopdata = readIonPop(ionpop_file)

    
    # ----------------------------------------------------------------------------------------------#
    #                                                                                               #
    #                                  INITIALIZE GUI ELEMENTS                                      #
    #                                                                                               #
    #-----------------------------------------------------------------------------------------------#
    
    # Setup the variables to use in the GUI entries
    guiVars.setupVars(parent)
    
    # Initialize the main simulation window, with the main plot inside
    sim, panel_1, f, a, figure_frame, canvas = configureSimuPlot()
    &#34;&#34;&#34;
    sim: variable to hold the tkinter simulation window object.
    panel_1: panel object that holds the matplotlib graph in the interface.
    f: matplotlib figure object where the graph will be displayed.
    a: matplotlib plot object where we can plot the data.
    figure_frame: frame that is placed inside the panel_1 object where the figure will be placed.
    canvas: tkinter object created from the matplotlib figure which is required to place the figure in the interface.
    &#34;&#34;&#34;
    # Initialize the remaining panels containing the buttons and configuration entries for the simulation
    panel_2, toolbar_frame, toolbar, full_frame, buttons_frame, buttons_frame2, buttons_frame3, buttons_frame4 = configureButtonArea(sim, canvas)
    &#34;&#34;&#34;
    panel_2: panel object that holds the controls placed below the graph
    toolbar_frame: frame that holds the toolbar buttons for the matplotlib plot
    toolbar: default toolbar buttons for the matplotlib plot
    full_frame: full frame for the button area to configure the simulations
    buttons_frame: frame for the transition dropdown
    buttons_frame2: frame for the simulation bounds and number of points
    buttons_frame3: frame for the yoffset, energy offset and calculate
    buttons_frame4: frame for the progress bar
    &#34;&#34;&#34;
    # Finish the button area setup and bind the variables to the GUI elements
    setupButtonArea(buttons_frame, buttons_frame2, buttons_frame3, buttons_frame4)
    
    # Bind the default matplotlib shortcuts
    canvas.mpl_connect(&#39;key_press_event&#39;, on_key_event)

    # Bind para correr a calculate quando se clica no enter
    sim.bind(&#39;&lt;Return&gt;&#39;, enter_function)
    
    # Setup the dropdown menus on the toolbar on the top of the window
    setupMenus(CS_exists)
    
    # ---------------------------------------------------------------------------------------------------------------
    # Initialize the main loop of the tk window (Enables the user interaction with the GUI)
    sim.mainloop()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="SpectraSimulations_git.aps" href="index.html">SpectraSimulations_git.aps</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="SpectraSimulations_git.aps.SpecSimu.simulateSpectra" href="#SpectraSimulations_git.aps.SpecSimu.simulateSpectra">simulateSpectra</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>